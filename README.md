# Тезническое задание
 
# Общие сведения и предпосылки

С 2013 года я занимаюсь изучением вопроса возможного предсказания рынка валют и теперь крипто активов.
Из многочисленных исследований и собственных наблюдений можно сделать несколько выводов а крипторынке
1.	Рынок на больших таймфремах скорее вероятностно предопределенный, чем хаотичный.
2.	Рынок в большей степени зависит от решений маркет мейкеров чем от игроков в стакане цен (исследование группы показало, что до 93% всей ликвидности на биржах принадлежат двум компаниям и только 2-3% игрокам, остальное институционалам) 
3.	Маркетмейкеры являются основными бенефициарами разгона и падения рынков, но и они пользуются годовой сезонностью для усиления эффекта. Годовая сезонность связана с вливанием свободных средств граждан всех стран с целью обогатится или получить опыт на свободных «лишних» деньгах. Как правило рост рынков совпадает с периодом выплат премий по двум финансовым отчетным периодом конец третьего квартала и подведение итогов фин года – период первого квартала. В эти периоды менеджемент максимально лоялен риску и начинает инвестиции полученными свободными средствами.
4.	Собственные наработки моделей предсказаний используя технический анализ и инструмент от google TesnsorFlow на 10 летней истории Bitcoin позволили получить превосходные результаты на периоде известном нейронке и бесполезные для нового периода. Сравнить это можно с тем, как если бы мы учили нейронку переводу слов, с чем нейронка прекрасно справляется, и переводить те же слова и выражения, которыми мы пользуемся сейчас для нее не проблема, но если бы буквы, слова, выражения менялись каждый день, нейронка не смогла бы в достаточной степени вероятности делать правильный перевод, так как меняются правила слишком быстро и не заметно для нейронки.
5.	Использование OnChain данных с желанием найти предикторы движения цены, например приток средст на биржи, кол-во новых монет, новых кошельков, активности в сети так же не дали результатов. Так как скорее всего большинство людей сначала видят движение цены, а потом активизируются в Твиттерах, в депозитах и прочих следах активности.
6.	Однако у рынка есть свои законы, знания о них могут помочь в создании доходной модели алгоритмичной торговли. Так, например рынок четко положительно реагирует на периоды квартальных премий, которые приходятся на конец третьего квартала и годовых премий период первого квартала. И отрицательно на период летних отпусков, когда люди предпочитают тратить средства на отпуска, а не на инвестиции. Другими словами, у рынков есть ярка выраженная сезонность.
7.	Рынок на малых таймфремах – это шум.

# Три силы рынка, как основы сеточной торговой модели
1.	Маркет мейкер
2.	Сезонность
3.	Новости проекта

В задачи маркет мейкера входит либо поддерживать стабильность цены, как это делает ЦБ у Государства, или операторы – владельцы stable coins (USDC, USDT, BUSD, PAX, TERRA и прочие) либо наоборот, формировать волну волатильности эмитируя у участников ощущения предсказуемости поведения рынка, например по анализу средних скользящих, уровней поддержки, сопротивления и кучи других якобы гарантирующих закономерности поведения цены. Все это для того, чтобы возникло желание играть и выигрывать у трейдеров- спекулянтов.
Зарабатывает же маркет мейкер на спреде и вознаграждения от биржи за предоставленные объемы в пулы ликвидности. Так например, маркетмейкер только очень не большой объем продаст за минимальный спред, если входить по рынку большим ордером, будет проскальзывание которое и формирует представление о реальном спреде и понимание сколько маркет мейкер заработает за такую сделку, достаточно продать по рынку и тут же купить по рынку на 1 млн долларов крипто актива, остаток и укажет на то, сколько ушло на комиссию и сколько заработал маркет мейкер.
В обычном мире чем больше ты покупаешь, тем больше скидка, и выгодней цена. На бирже все, наоборот, чем больше ты покупаешь, тем выше цена.
Риски у маркет мейкеров.
Маркет мейкер тоже рискует, например есть технические сбои на бирже и маркет мейкер может потерять так же при задержках исполнения ордера биржей. Были случаи, когда BIFINEX ставил в очередь на десятки минут на исполнение лимитных и рыночных ордеров.
Маркет мейкеру так же приходится учитывать сезонность, действия арбитражников (высокочастотная торговля) и прочие нюансы в своей работе. Одной из проблем маркет мейкеров на спотовом рынке, это то, что они одновременно в наличии должны держать обе валюты и заработок должен покрывать разницу в падении стоимости криптовалюты. Поэтому этот риск они научились передавать тем же пользователям создав пулы ликвидности. Теперь маркет мейкеры просто делятся с поставщиком ликвидности частью спреда и экономией на комиссии, оставляя риски падения стоимости актива у инвестора.
Однако это не убирает требования у маркет мейкера управлять ликвидностью, и периодически перекладывать её в парах из левой стороны пары в правую то покупая, то продавая BTC например. Так как стакан должен быть уравновешен.
Для этого маркер делает такие перевороты в лучшей для него цене. Продает дорого и много перед разворотом вниз, закупает дёшево перед разворотом вверх. Однако макет мейкеру для переворота своих активов нужен объем от пользователей, чтобы не покупать у самого себя. Поэтому чаще всего на положительных новостях проекта и общем медвежьем тренде маркет мейкер поставит барьерный уровень продав максимально своей ликвидности, не дав цене высоко подняться, а потом заставит тех, кто вошёл выйти, двинув цену в зону Stop Loss и таким образом получит еще ликвидности и убытки игроков себе в карман.
Так как невозможно предсказать действия маркет мейкера в моменте мы должны исходить из того, что волатильностью, которую он создает, управлять мы сможем только усреднением. Для этого предлагается использовать сеточную торговлю.
Пример и принцип сеточного торговли

Сеточная торговля подразумевает торговлю используя гипотезу, что цена возвращается и не ходит только вверх или только вниз, у цены есть корректировки и это даёт возможность фиксировать прибыль.

 

# Проблемы сеточной торговли
 
Как и у маркет мейкера у сеточной торговли ещё больше проблем.
Во-первых, у обычного трейдера недостаточно ликвидности для удержания баланса 50/50 в долгую.
Например, если трейдер начал был торговать в конце 2017 года, то сравнительно скоро трейдер своей сеткой купил падающий биткойн и два года ждал бы восстановления. Поэтому важно:
1.	следить за трендом, и не работать «контр-трендово» т.е. против тренда 
2.	Убирать сетку при аномальном однобоком (без корректировок) быстром движении на рынке (принцип безопасной циркулярной пилы https://www.youtube.com/watch?v=Pi2YuNkXpAU)
3.	Расширять шаг сетки в зависимости от волатильности.
4.	Время от времени фиксировать убытки и закрывать открытые ордера при прогнозе разворота тренда.
5.	Перестраивать сетку после получения нового прогноза (настраиваемый параметр, по-умолчанию каждые 4 часа).
6.	Увеличивать объемы сделок при нарастании не закрытых ордеров (адаптивный мартингейл)
7.	Минимизировать риски п. 6 работать только по тренду.
Техническое задание Python + язык для интерфейса на выбор подрядчика

1.	Создать код по скачиванию временных рядов цены с достоверными данными, тиковой, минутной часовой и дневной истории.
2.	Создать пополняемую базу данных для тестирования будущего алгоритма
3.	Создать модуль прогнозирования тренда и прогноза средней, верхней и нижней цены канала. Используя Facebook Prophet.
4.	Создать модуль авто-оптимизации прогноза.
5.	Создать модуль формирования сетки из расчета п3, а также из оценки волатильности для расчета шага, оценки маржи для расчета объема и кол-ва лотов в сетке. (пример 3commas.com grid bot)
6.	Создать модуль управления рисками. Отменять сетку при аномалиях на рынке. Увеличивать шаг. Менять направленность ордеров в сторону тренда.
7.	Создать модуль API 3commas.com для работы алгоритма с биржей
8.	Создать интерфейс Backtest для тестирования стратегии с учетом спреда комиссий и проскальзывания.
9.	Создать визуализацию тестирования работы бота на тиковой и минутной истории

# Примеры ситуаций на рынке и ожидаемая работа алгоритмов

 
Стандартный шаг Take profit для каждого инструмента ставим вручную, шаг сетки так же, стандартный ставим вручную, но:
1.	Если растущий тренд, то формируем сетку BUY ниже действующей цены и ниже прогнозной средней цены. 
Шаг Tack Profit увеличивается на стандартный шаг * (1+ коэффициент прогноз увеличения цены следующего дня). При этом сетка отложенных ордеров на покупку, сжимается по условию шаг сетки = шаг стандартный * (1- коэффициент роста увеличения цены) 
При растущем тренде, но при всплеске цены выше прогнозной верхней цены коридора, шортим сеткой выше коридора. 

               
2.	В обратном порядке если прогнозируется падающий тренд. 
При падающим тренде, но выходе цены за пределы прогнозной нижней цены, строим лонг сетку ниже коридора.
